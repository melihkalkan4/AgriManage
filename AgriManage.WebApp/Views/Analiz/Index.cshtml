@model AgriManage.BusinessLogic.Dtos.AnalizDto

@{
    ViewData["Title"] = "Detaylı Analizler";
}

<div class="container-fluid py-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h2 class="fw-bold text-dark"><i class="fa-solid fa-chart-column me-2 text-primary"></i>İşletme Raporları</h2>
            <p class="text-muted mb-0">Finansal durum ve üretim verimliliği analizleri.</p>
        </div>
        <button class="btn btn-outline-dark btn-sm"><i class="fa-solid fa-print me-2"></i>Yazdır</button>
    </div>

    <div class="card shadow-sm border-0 mb-4">
        <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
            <h5 class="mb-0 text-secondary fw-bold">Gelir / Gider Dengesi</h5>
            <span class="badge bg-success bg-opacity-10 text-success">Son 6 Ay</span>
        </div>
        <div class="card-body">
            <div style="height: 350px; width: 100%;">
                <canvas id="finansChart"></canvas>
            </div>
        </div>
    </div>

    <div class="row g-4">
        <div class="col-lg-4">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-white py-3 border-bottom-0">
                    <h6 class="fw-bold text-dark"><i class="fa-solid fa-seedling text-success me-2"></i>Tahmini Hasat (Ton)</h6>
                </div>
                <div class="card-body">
                    <canvas id="urunChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-white py-3 border-bottom-0">
                    <h6 class="fw-bold text-dark"><i class="fa-solid fa-wallet text-danger me-2"></i>Harcama Kalemleri</h6>
                </div>
                <div class="card-body">
                    <canvas id="giderChart"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-4">
            <div class="card shadow-sm border-0 h-100">
                <div class="card-header bg-white py-3 border-bottom-0">
                    <h6 class="fw-bold text-dark"><i class="fa-solid fa-medal text-warning me-2"></i>Ayın Personelleri</h6>
                </div>
                <div class="card-body">
                    <canvas id="personelChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // 1. FİNANSAL
        new Chart(document.getElementById('finansChart'), {
            type: 'line',
            data: {
                labels: @Html.Raw(Json.Serialize(Model.Aylar)),
                datasets: [
                    {
                        label: 'Gelir (TL)',
                        data: @Html.Raw(Json.Serialize(Model.Gelirler)),
                        borderColor: '#198754',
                        backgroundColor: 'rgba(25, 135, 84, 0.1)',
                        fill: true, tension: 0.4
                    },
                    {
                        label: 'Gider (TL)',
                        data: @Html.Raw(Json.Serialize(Model.Giderler)),
                        borderColor: '#dc3545',
                        backgroundColor: 'rgba(220, 53, 69, 0.05)',
                        fill: true, tension: 0.4
                    }
                ]
            },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true } } }
        });

        // 2. ÜRÜN
        new Chart(document.getElementById('urunChart'), {
            type: 'bar',
            data: {
                labels: @Html.Raw(Json.Serialize(Model.UrunAdlari)),
                datasets: [{
                    label: 'Ton',
                    data: @Html.Raw(Json.Serialize(Model.BeklenenHasatTon)),
                    backgroundColor: '#ffc107', borderRadius: 5
                }]
            },
            options: { responsive: true, plugins: { legend: { display: false } } }
        });

        // 3. GİDER
        new Chart(document.getElementById('giderChart'), {
            type: 'doughnut',
            data: {
                labels: @Html.Raw(Json.Serialize(Model.GiderKalemleri)),
                datasets: [{
                    data: @Html.Raw(Json.Serialize(Model.GiderTutarlari)),
                    backgroundColor: ['#0d6efd', '#6610f2', '#fd7e14', '#20c997', '#dc3545']
                }]
            },
            options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
        });

        // 4. PERSONEL
        new Chart(document.getElementById('personelChart'), {
            type: 'bar',
            data: {
                labels: @Html.Raw(Json.Serialize(Model.PersonelAdlari)),
                datasets: [{
                    label: 'Bitirilen Görev',
                    data: @Html.Raw(Json.Serialize(Model.TamamlananGorevler)),
                    backgroundColor: '#0dcaf0', borderRadius: 5
                }]
            },
            options: { indexAxis: 'y', responsive: true, plugins: { legend: { display: false } } }
        });
    </script>
}   